name: ğŸš€ Build and Deploy

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v3
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ”¨ Run Build Pipeline
      run: python3 build_site.py
      
    - name: ğŸ“Š Upload Minified HTML
      uses: actions/upload-artifact@v4
      with:
        name: production-build
        path: index.min.html
        
    - name: ğŸ“ˆ Upload Metrics
      run: |
        echo "## ğŸ“Š Build Metrics" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY
        echo "- ğŸ“¦ Artifact: index.min.html" >> $GITHUB_STEP_SUMMARY
        
  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v3
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: ğŸ”¨ Build Site
      run: python3 build_site.py
      
    # Descomentar y configurar segÃºn tu mÃ©todo de deploy:
    
    # OpciÃ³n 1: Deploy a GitHub Pages
    # - name: ğŸš€ Deploy to GitHub Pages
    #   uses: peaceiris/actions-gh-pages@v3
    #   with:
    #     github_token: ${{ secrets.GITHUB_TOKEN }}
    #     publish_dir: ./
    #     publish_branch: gh-pages
    
    # OpciÃ³n 2: Deploy a Netlify
    # - name: ğŸš€ Deploy to Netlify
    #   uses: nwtgck/actions-netlify@v2
    #   with:
    #     publish-dir: './index.min.html'
    #     production-deploy: true
    #   env:
    #     NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
    #     NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
    
    # OpciÃ³n 3: Deploy por FTP
    # - name: ğŸš€ FTP Deploy
    #   uses: SamKirkland/FTP-Deploy-Action@4.3.0
    #   with:
    #     server: ${{ secrets.FTP_SERVER }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ secrets.FTP_PASSWORD }}
    #     local-dir: ./
